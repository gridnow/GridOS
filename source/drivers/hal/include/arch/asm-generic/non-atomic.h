#ifndef HAL_GENERIC_NON_ATOMIC_H
#define HAL_GENERIC_NON_ATOMIC_H

static inline int __test_and_set_bit(int nr, volatile unsigned long *addr)
{
	unsigned long mask = BIT_MASK(nr);
	unsigned long *p = ((unsigned long *)addr) + BIT_WORD(nr);
	unsigned long old = *p;

	*p = old | mask;
	return (old & mask) != 0;
}
#endif
